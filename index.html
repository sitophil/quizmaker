<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¨Ø¯Ù„ Ø¢Ø²Ù…ÙˆÙ† Ù…Ø¯Ø±Ù†</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        :root { --primary: #6c5ce7; --secondary: #a29bfe; --bg: #f0f3f7; }
        body { font-family: Vazirmatn, sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: #2d3436; }
        .converter-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); text-align: center; max-width: 450px; width: 90%; border: 1px solid #e1e8ed; }
        .icon { font-size: 50px; margin-bottom: 10px; }
        h2 { margin-top: 0; font-weight: 800; color: var(--primary); }
        .file-upload { border: 2px dashed #cbd5e0; padding: 30px; border-radius: 15px; margin: 25px 0; cursor: pointer; transition: 0.3s; position: relative; }
        .file-upload:hover { border-color: var(--primary); background: #f8faff; }
        input[type="file"] { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        .btn { background: var(--primary); color: white; border: none; padding: 14px 28px; border-radius: 12px; font-family: Vazirmatn; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3); transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4); }
    </style>
</head>
<body>

<div class="converter-card">
    <div class="icon">ğŸš€</div>
    <h2>Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¢Ø²Ù…ÙˆÙ† Ù‡ÙˆØ´Ù…Ù†Ø¯</h2>
    <p>ÙØ§ÛŒÙ„ CSV Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¬Ø§Ø¯ÙˆÛŒ Ù…Ø§ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯</p>
    
    <div class="file-upload">
        <span id="fileName">Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ CSV</span>
        <input type="file" id="csvFile" accept=".csv" onchange="updateName()">
    </div>
    
    <button class="btn" onclick="processFile()">ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ HTML Ø¢Ø²Ù…ÙˆÙ†</button>
</div>

<script>
function updateName() {
    const file = document.getElementById('csvFile').files[0];
    if(file) document.getElementById('fileName').innerText = file.name;
}

function processFile() {
    const fileInput = document.getElementById('csvFile');
    if (!fileInput.files[0]) return alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!");

    const reader = new FileReader();
    reader.onload = function(e) {
        const text = e.target.result;
        const rows = text.split('\n').filter(row => row.trim() !== '');
        const questions = rows.map(row => {
            const cols = row.split(',').map(c => c.trim());
            return { q: cols[0], options: [cols[1], cols[2], cols[3], cols[4]], ans: parseInt(cols[5]) };
        });
        generateHTML(questions);
    };
    reader.readAsText(fileInput.files[0]);
}

function generateHTML(data) {
    const template = `
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¢Ø²Ù…ÙˆÙ† Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css');
        :root { --p: #6c5ce7; --bg: #f8f9fd; }
        body { font-family: Vazirmatn, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .quiz-card { background: white; width: 90%; max-width: 600px; border-radius: 24px; padding: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.08); position: relative; overflow: hidden; }
        .progress-bar { position: absolute; top: 0; left: 0; height: 6px; background: var(--p); transition: 0.4s; }
        .q-text { font-size: 22px; font-weight: bold; margin-bottom: 30px; color: #2d3436; }
        .opt { display: flex; align-items: center; padding: 15px 20px; border: 2px solid #edf2f7; border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; }
        .opt:hover { border-color: var(--p); background: #f4f2ff; }
        .opt.selected { border-color: var(--p); background: var(--p); color: white; }
        .nav-btns { display: flex; justify-content: space-between; margin-top: 30px; }
        .n-btn { background: var(--p); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-family: Vazirmatn; font-size: 16px; }
        .n-btn:disabled { background: #ccc; cursor: not-allowed; }
        #result-screen { display: none; text-align: center; }
        canvas { max-width: 250px; margin: 20px auto; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .stat-box { padding: 15px; border-radius: 12px; background: #f1f2f6; }
    </style>
</head>
<body>
    <div class="quiz-card">
        <div class="progress-bar" id="pb"></div>
        
        <div id="quiz-screen">
            <div id="q-number" style="color: #636e72; font-size: 14px; margin-bottom: 10px;"></div>
            <div class="q-text" id="q-content"></div>
            <div id="options-container"></div>
            <div class="nav-btns">
                <button class="n-btn" id="prevBtn" onclick="prevQ()">Ù‚Ø¨Ù„ÛŒ</button>
                <button class="n-btn" id="nextBtn" onclick="nextQ()">Ø¨Ø¹Ø¯ÛŒ</button>
            </div>
        </div>

        <div id="result-screen">
            <h2>Ù†ØªÛŒØ¬Ù‡ Ø¢Ø²Ù…ÙˆÙ† Ø´Ù…Ø§</h2>
            <canvas id="myChart"></canvas>
            <div class="stat-grid">
                <div class="stat-box">Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: <b id="c-count" style="color:green"></b></div>
                <div class="stat-box">Ù¾Ø§Ø³Ø® ØºÙ„Ø·: <b id="w-count" style="color:red"></b></div>
            </div>
            <button class="n-btn" style="margin-top:20px; width:100%" onclick="location.reload()">Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ø¯Ù‡</button>
        </div>
    </div>

    <script>
        const quizData = ${JSON.stringify(data)};
        let currentIdx = 0;
        let userAnswers = new Array(quizData.length).fill(null);

        function showQuestion() {
            const q = quizData[currentIdx];
            document.getElementById('q-number').innerText = 'Ø³ÙˆØ§Ù„ ' + (currentIdx + 1) + ' Ø§Ø² ' + quizData.length;
            document.getElementById('q-content').innerText = q.q;
            document.getElementById('pb').style.width = ((currentIdx + 1) / quizData.length * 100) + '%';
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'opt' + (userAnswers[currentIdx] === i + 1 ? ' selected' : '');
                div.innerText = opt;
                div.onclick = () => selectOpt(i + 1);
                container.appendChild(div);
            });

            document.getElementById('prevBtn').disabled = currentIdx === 0;
            document.getElementById('nextBtn').innerText = currentIdx === quizData.length - 1 ? 'Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†ØªÛŒØ¬Ù‡' : 'Ø¨Ø¹Ø¯ÛŒ';
        }

        function selectOpt(val) {
            userAnswers[currentIdx] = val;
            showQuestion();
        }

        function nextQ() {
            if (currentIdx < quizData.length - 1) {
                currentIdx++;
                showQuestion();
            } else {
                showResults();
            }
        }

        function prevQ() {
            if (currentIdx > 0) {
                currentIdx--;
                showQuestion();
            }
        }

        function showResults() {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            let correct = 0;
            userAnswers.forEach((ans, i) => {
                if(ans === quizData[i].ans) correct++;
            });
            const wrong = quizData.length - correct;

            document.getElementById('c-count').innerText = correct;
            document.getElementById('w-count').innerText = wrong;

            new Chart(document.getElementById('myChart'), {
                type: 'doughnut',
                data: {
                    labels: ['ØµØ­ÛŒØ­', 'ØºÙ„Ø·'],
                    datasets: [{
                        data: [correct, wrong],
                        backgroundColor: ['#00b894', '#ff7675']
                    }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        }

        showQuestion();
    <\/script>
</body>
</html>`;

    const blob = new Blob([template], { type: 'text/html' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'modern_quiz.html';
    link.click();
}
</script>

</body>
</html>
